# IM 

[![standard-readme compliant](https://img.shields.io/badge/readme%20style-standard-brightgreen.svg?style=flat-square)](https://github.com/RichardLitt/standard-readme)


此项目基于公司目前业务场景抽离的基础部分进行开源，此部分为用户与服务器维持基础连接，
im是一个通用的服务组件，且每个公司都希望拥有更好的用户体验。本项目会随着公司业务不断
的迭代，后续更新版本也会在github上更新


## 目录
 - [背景](##背景)
 - [安装](##安装)
 - [快速开始](##快速开始)
 - [性能](##性能)
    - [连接保持](##连接保持)
    - [消息下推](##消息下推)
    - [消息广播](##消息广播)
 
 
## 背景
  在最开始公司场景应用过程中只是做了很简单的单点im服务器，随着公司业务需求扩大，
  业务版本迭代加快，当时的im服务和业务耦合程度非常的深入，基本没有分离，每次更新
  就需要停服更新，用户体验十分不好。而后将im 做为一个公共组件进行封装，业务层单独
  抽离，im服务就应运而生。
  
  在这个im项目上只需要专注于：
  - `用户链接保持`
  - `消息编解码`
  - `消息下推`
  - `在线状态维护`
  
  要多记住这几个功能，整个im服务都是不断的更新升级这几个基础工作。
  后续压力测试也将不断的围绕这几个功能进行测试
## 安装
  `go get github.com/mongofs/im`
  
   im 最多支持最新的两个go版本，请保证你本地的版本号
   
   
## 快速开始
你只需要在你的项目中使用下面这段代码，你就可以启动一个简易的IM聊天服务器，http默认端口是：8080，
RPC 服务端口默认是：8081，访问`ws://localhost:8080/chat?token=12345`即可建立连接。
```
    bs := im.New()
	err := bs.Run()
	if err !=nil {
		log.Fatal(err)
	}
	bs.Close()
```
## 性能

####连接性能测试


####单条消息下推性能测试


####广播消息下推性能测试



## 关于选项

#### 设置心跳
因为每个公司的心跳业务都不统一，im封装默认的就是120s ，具体设置在创建server的时候
设置option ：

`WithClientHeartBeatInterval(120)` ：代表客户端需要120秒内调用一下ResetHeartBeat
否则会被bucket的keepalive 服务踢下线。

每个公司的心跳业务也不一样，这里建议做法是在注册一个handler 方法，从用户通道接收
到的消息，都会默认推送到这里来。在这里可以调用cli 对象的resetheartbeat方法重置
客户端下次的时间。

心跳是一个长连接服务必带的一个服务，是保证连接高可用的前提。在复杂的网络环境中，保证
链路通畅是一个必须的动作，在中国的网络提供上：移动、联通、电信都会为了保证自己的NAT
的压力，会定时清除掉没有活跃的链接，用户在定义心跳包的时长的时候需要根据自己的业务进行
设置，因为客户端的多样性，建议设置为2min以内。












